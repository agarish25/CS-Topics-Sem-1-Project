<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bike Game with Duck Images</title>
    <style>
        /* basic page setup */
        body {
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #484848;
        }

        /* game board styles */
        #game-board {
            position: relative;
            width: 480px;
            height: 525px;
            background-color: #d6d6d6;
            border: 2px solid black;
        }

        /* squares for the grid */
        .square {
            position: absolute;
            width: 40px;
            height: 40px;
        }

        /* styles for the score bar */
        #top-bar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 45px;
            background-color: #484848;
            color: #d6d6d6;
            font-family: Helvetica, Arial, sans-serif;
            font-size: 24px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-bottom: 2px solid black;
        }

        /* styles for icons */
        .icon {
            position: absolute;
            width: 35px;
            height: 35px;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div id="game-board">
        <div id="top-bar">Use W A S D to move</div> <!-- instructions bar -->
    </div>

    <script>
        class BikeGame {
            constructor() {
                this.gameBoard = document.getElementById("game-board");
                this.numSquares = 12; // grid size
                this.squareSize = 40; // size of each square
                this.topBarHeight = 45; // height of the bar at the top
                this.duckIconSize = 35; // size of icons
                this.squares = []; // 2D grid squares
                this.ducks = []; // stores ducks
                this.player = { x: 5, y: 5, direction: "up", tail: [] }; // player's position
                this.currentKey = null; // tracks key presses
                this.score = 0; // keeps track of the score
                this.gameInterval = null; // controls game timing

                // colors for the grid
                this.colors = {
                    darkGreen: "rgb(0, 128, 43)",
                    lightGreen: "rgb(0, 179, 60)",
                };

                // loading all images
                this.images = {
                    bike: {
                        right: this.loadImage("bikeRight.png"),
                        left: this.loadImage("bikeLeft.png"),
                        up: this.loadImage("bikeUp.png"),
                        down: this.loadImage("bikeDown.png"),
                    },
                    ducks: {
                        muddy: this.loadImage("duckMuddy.png"),
                        right: this.loadImage("duckRight.png"),
                        upRight: this.loadImage("duckUpRight.png"),
                        up: this.loadImage("duckUp.png"),
                        upLeft: this.loadImage("duckUpLeft.png"),
                        left: this.loadImage("duckLeft.png"),
                        downLeft: this.loadImage("duckDownLeft.png"),
                        down: this.loadImage("duckDown.png"),
                        downRight: this.loadImage("duckDownRight.png"),
                    },
                };

                this.init(); // starts everything
            }

            loadImage(src) {
                const img = new Image();
                img.src = src; // set image source
                img.style.width = `${this.duckIconSize}px`;
                img.style.height = `${this.duckIconSize}px`;
                return img;
            }

            init() {
                this.createGrid(); // make the game grid
                this.spawnDuck(); // add a duck
                this.renderPlayer(); // show the player
                this.startGameLoop(); // start game logic

                document.addEventListener("keydown", (e) => this.handleKeyPress(e)); // key listener
            }

            createGrid() {
                for (let row = 0; row < this.numSquares; row++) {
                    this.squares[row] = [];
                    for (let col = 0; col < this.numSquares; col++) {
                        const square = document.createElement("div");
                        square.className = "square";
                        square.style.left = `${col * this.squareSize}px`;
                        square.style.top = `${row * this.squareSize + this.topBarHeight}px`;
                        square.style.backgroundColor =
                            (row % 2 === 0 && col % 2 === 0) || (row % 2 === 1 && col % 2 === 1)
                                ? this.colors.darkGreen
                                : this.colors.lightGreen; // alternating colors
                        this.gameBoard.appendChild(square);
                        this.squares[row][col] = square;
                    }
                }
            }

            renderPlayer() {
                const playerImage = this.images.bike[this.player.direction]; // correct bike image

                // remove old player image
                if (this.player.element) {
                    this.player.element.remove();
                }

                // add player image
                const playerElement = playerImage.cloneNode();
                playerElement.style.position = "absolute";
                playerElement.style.left = `${this.player.x * this.squareSize + (this.squareSize - this.duckIconSize) / 2}px`;
                playerElement.style.top = `${this.player.y * this.squareSize + this.topBarHeight + (this.squareSize - this.duckIconSize) / 2}px`;
                this.gameBoard.appendChild(playerElement);
                this.player.element = playerElement;

                // render the tail
                this.player.tail.forEach((segment) => {
                    const tailImage = this.images.ducks.muddy;

                    if (segment.element) {
                        segment.element.remove();
                    }

                    const tailElement = tailImage.cloneNode();
                    tailElement.style.position = "absolute";
                    tailElement.style.left = `${segment.x * this.squareSize + (this.squareSize - this.duckIconSize) / 2}px`;
                    tailElement.style.top = `${segment.y * this.squareSize + this.topBarHeight + (this.squareSize - this.duckIconSize) / 2}px`;
                    this.gameBoard.appendChild(tailElement);
                    segment.element = tailElement;
                });
            }

            spawnDuck() {
                // add a duck randomly
                const duck = { x: Math.floor(Math.random() * this.numSquares), y: Math.floor(Math.random() * this.numSquares) };
                const duckElement = this.images.ducks.muddy.cloneNode();
                duckElement.style.position = "absolute";
                duckElement.style.left = `${duck.x * this.squareSize + (this.squareSize - this.duckIconSize) / 2}px`;
                duckElement.style.top = `${duck.y * this.squareSize + this.topBarHeight + (this.squareSize - this.duckIconSize) / 2}px`;

                this.ducks.push({ ...duck, element: duckElement });
                this.gameBoard.appendChild(duckElement);
            }

            handleKeyPress(event) {
                const key = event.key.toLowerCase();
                if (["w", "a", "s", "d"].includes(key)) {
                    this.currentKey = key; // change direction
                }
            }

            movePlayer() {
                const direction = this.currentKey;
                if (!direction) return;

                const newTail = [{ x: this.player.x, y: this.player.y }, ...this.player.tail];
                newTail.pop();
                this.player.tail = newTail;

                // update player position
                if (direction === "w") this.player.y--;
                if (direction === "a") this.player.x--;
                if (direction === "s") this.player.y++;
                if (direction === "d") this.player.x++;

                this.checkGameOver();
                this.renderPlayer();
            }

            checkGameOver() {
                // check if the player hit the wall
                if (
                    this.player.x < 0 ||
                    this.player.x >= this.numSquares ||
                    this.player.y < 0 ||
                    this.player.y >= this.numSquares
                ) {
                    this.endGame("You hit a wall!");
                }
            }

            checkCollisions() {
                // check if the player hit a duck
                for (let i = this.ducks.length - 1; i >= 0; i--) {
                    const duck = this.ducks[i];
                    if (this.player.x === duck.x && this.player.y === duck.y) {
                        this.ducks.splice(i, 1);
                        duck.element.remove();
                        this.score++;
                        this.player.tail.push({ x: duck.x, y: duck.y });
                        this.spawnDuck();
                        this.updateScore();
                    }
                }
            }

            updateScore() {
                // update the top bar with the score
                const topBar = document.getElementById("top-bar");
                topBar.innerText = `Score: ${this.score}`;
            }

            startGameLoop() {
                // repeat game actions every 250ms
                this.gameInterval = setInterval(() => {
                    this.movePlayer();
                    this.checkCollisions();
                }, 250);
            }

            endGame(message) {
                // stop game and reload
                clearInterval(this.gameInterval);
                alert(`${message} Game Over! Final Score: ${this.score}`);
                window.location.reload();
            }
        }

        // start the game when the page loads
        window.onload = () => {
            new BikeGame();
        };
    </script>
</body>
</html>
